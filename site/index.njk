---
layout: base.njk
title: Family Tree
---
{% from "person-tree.njk" import renderPerson %}

<header class="royal-header">
  <div class="royal-crown">‚ôõ</div>
  <h1>Family Tree</h1>
  <p class="royal-subtitle">Generated with Eleventy</p>
  <p class="tree-source">Source folder: <code>{{ familyTree.sourceDir }}</code></p>

  <div class="controls controls--view" role="group" aria-label="Select family tree view">
    <button id="view-list" class="view-btn is-active" data-view="list" type="button" aria-pressed="true">List View</button>
    <button id="view-graph" class="view-btn" data-view="graph" type="button" aria-pressed="false">Graph View</button>
  </div>
  <p class="tree-legend" aria-label="Tree legend">
    <span class="legend-chip deceased">‚Ä† Deceased</span>
  </p>
</header>

<main>
  <p id="a11y-status" class="sr-only" role="status" aria-live="polite" aria-atomic="true"></p>

  {% if familyTree.error %}
    <div class="build-error">
      <h2>Build Input Error</h2>
      <p>{{ familyTree.error }}</p>
      <p>Set <code>FAMILY_DATA_DIR</code> to a valid folder path.</p>
    </div>
  {% elseif not familyTree.root %}
    <div class="build-error">
      <h2>No root person found</h2>
      <p>Check person markdown files and `_marriage.md` references.</p>
    </div>
  {% else %}
    <section id="list-view" class="tree-view tree-view--list">
      <div class="controls controls--list">
        <button id="expand-all" type="button" aria-label="Expand all family branches">Expand All</button>
        <button id="collapse-all" type="button" aria-label="Collapse all family branches except the root">Collapse All</button>
      </div>
      <ul class="family-tree">
        {{ renderPerson(familyTree.root, 0) }}
      </ul>
    </section>

    <section id="graph-view" class="tree-view tree-view--graph" data-path-prefix="{{ '/' | url }}" hidden>
      <div class="controls controls--graph">
        <button id="graph-reset-view" type="button" aria-label="Reset graph zoom and pan to fit">Reset Graph View</button>
      </div>
      <p class="graph-instructions">Drag to pan. Scroll/pinch or double-tap to zoom.</p>
      <div class="graph-canvas" id="graph-canvas" role="img" aria-label="Royal family relationship graph">
        <div class="graph-world" id="graph-world">
          <svg class="graph-links" id="graph-links" aria-hidden="true"></svg>
          <div class="graph-nodes" id="graph-nodes"></div>
        </div>
      </div>
    </section>
  {% endif %}

  <div class="details-overlay" id="details-overlay" hidden>
    <div class="details-dialog" id="details-dialog" role="dialog" aria-modal="true" aria-labelledby="details-name" aria-describedby="details-context" tabindex="-1">
      <p id="details-context" class="sr-only">Details dialog. Press Escape to close. Tab stays inside the dialog.</p>
      <button class="details-close" id="details-close" aria-label="Close details dialog">‚úï</button>

      <div class="details-avatar-wrap">
        <div class="details-avatar" id="details-avatar"></div>
      </div>

      <h2 class="details-name" id="details-name"></h2>
      <div class="details-spouses" id="details-spouses"></div>

      <div class="details-meta">
        <div class="details-meta-row">
          <span class="details-meta-icon">üìÖ</span>
          <span class="details-meta-label">Born</span>
          <span class="details-meta-value details-placeholder" id="details-born">‚Äî</span>
        </div>
        <div class="details-meta-row">
          <span class="details-meta-icon">üìÖ</span>
          <span class="details-meta-label">Died</span>
          <span class="details-meta-value details-placeholder" id="details-died">‚Äî</span>
        </div>
        <div class="details-meta-row">
          <span class="details-meta-icon">üë•</span>
          <span class="details-meta-label">People</span>
          <span class="details-meta-value">{{ familyTree.totalPeople }}</span>
        </div>
        <div class="details-meta-row details-meta-row--small">
          <span class="details-meta-icon">üñºÔ∏è</span>
          <span class="details-meta-label">Photo fallback</span>
          <span class="details-meta-value">{{ familyTree.imageFallbackOrder | join(', ') }}</span>
        </div>
      </div>

      <section class="details-bio" aria-label="Biography">
        <h3 class="details-bio-title">Biography</h3>
        <div class="details-bio-content" id="details-bio-content" tabindex="0" role="region" aria-label="Biography content">
          <p class="details-placeholder">No biography text provided.</p>
        </div>
      </section>
    </div>
  </div>

  <script id="graph-data" type="application/json">{{ familyTree.graphJson | safe }}</script>
  <script src="https://cdn.jsdelivr.net/npm/d3@7/dist/d3.min.js"></script>
</main>
